name: Deploy to Hetzner

on:
  push:
    branches:
      - main
  workflow_dispatch: # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é –∫–Ω–æ–ø–∫—É

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy via SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HETZNER_HOST }}
          username: ${{ secrets.HETZNER_USERNAME }}
          key: ${{ secrets.HETZNER_SSH_KEY }}
          port: 22
          script: |
            # 1. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
            cd /opt/VpnBot
            
            # 2. –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥
            # –í–ù–ò–ú–ê–ù–ò–ï: –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–¥–µ–ª–∞–Ω git clone!
            echo "üì• Pulling latest code..."
            git pull origin main
            
            # 3. –°–æ–±–∏—Ä–∞–µ–º –±–∏–Ω–∞—Ä–Ω–∏–∫
            # –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç–∏ –∫ Go (–Ω–∞ —Å–ª—É—á–∞–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–µ—Ä–µ–∑ apt –∏–ª–∏ –≤—Ä—É—á–Ω—É—é)
            export PATH=$PATH:/usr/local/go/bin:/usr/bin
            
            echo "üî® Building Go binary..."
            go build -o app_bin main.go
            
            # 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å
            echo "üîÑ Restarting service..."
            systemctl restart vpnbot
            
            # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
            systemctl status vpnbot --no-pager