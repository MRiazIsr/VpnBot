name: Deploy to Hetzner

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy via SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HETZNER_HOST }}
          username: ${{ secrets.HETZNER_USERNAME }}
          key: ${{ secrets.HETZNER_SSH_KEY }}
          port: 22
          script: |
            # 1. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
            cd /opt/vpnbot
            
            # 2. –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥
            echo "üì• Pulling latest code..."
            git pull origin main
            
            # 3. –°–æ–±–∏—Ä–∞–µ–º –±–∏–Ω–∞—Ä–Ω–∏–∫ (—Ç–µ–ø–µ—Ä—å –≤ –∫–æ—Ä–Ω–µ)
            echo "üî® Building Go binary..."
            /usr/local/go/bin/go build -o app_bin main.go
            
            # 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å
            echo "üîÑ Restarting service..."
            systemctl restart vpnbot
            
            # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
            systemctl status vpnbot --no-pager